{"ast":null,"code":"var _jsxFileName = \"/Users/pablognecco/Dropbox (Personal)/Studio/Civic/pitch/framer-motion-bubbles/src/components/CompanyQRCode.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '../config/supabase';\nimport QRCode from \"react-qr-code\";\nimport { motion } from \"framer-motion\";\nimport { getCachedData, cacheData, isOnline } from '../utils/cacheManager';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CompanyQRCode(_ref) {\n  _s();\n  let {\n    companyId,\n    size = 128\n  } = _ref;\n  const [websiteUrl, setWebsiteUrl] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const cacheKey = \"company_qr_\".concat(companyId);\n  useEffect(() => {\n    if (!companyId) {\n      setLoading(false);\n      setError(\"No company ID provided.\");\n      return;\n    }\n\n    // Try cache first\n    const cachedUrl = getCachedData(cacheKey);\n    if (cachedUrl) {\n      setWebsiteUrl(cachedUrl);\n      setLoading(false);\n    }\n    const fetchCompanyUrl = async () => {\n      if (!isOnline()) {\n        if (!cachedUrl) setError(\"Offline and no data in cache.\");\n        setLoading(false);\n        return;\n      }\n      setLoading(true);\n      setError(null);\n      try {\n        console.log(\"[QRCode] Fetching from Supabase with id: \".concat(companyId));\n        const {\n          data,\n          error\n        } = await supabase.from('companies').select('website').eq('id', companyId).maybeSingle();\n        console.log(\"[QRCode] Supabase fetch response:\", {\n          data,\n          error\n        });\n        if (error) throw error;\n        const url = data && data.website;\n        setWebsiteUrl(url);\n        if (url) {\n          cacheData(cacheKey, url);\n        }\n      } catch (err) {\n        console.error(\"Error fetching company URL:\", err);\n        setError(\"Failed to load company data.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchCompanyUrl();\n    const subscription = supabase.channel(\"company-website-\".concat(companyId)).on('postgres_changes', {\n      event: 'UPDATE',\n      schema: 'public',\n      table: 'companies',\n      filter: \"id=eq.\".concat(companyId)\n    }, payload => {\n      const newUrl = payload.new.website;\n      if (newUrl !== websiteUrl) {\n        setWebsiteUrl(newUrl);\n        cacheData(cacheKey, newUrl);\n      }\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(subscription);\n    };\n  }, [companyId, websiteUrl, cacheKey]);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0\n      },\n      animate: {\n        opacity: 1\n      },\n      style: {\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        width: size,\n        height: size,\n        backgroundColor: 'var(--bg-secondary)',\n        borderRadius: '8px',\n        color: 'var(--text-secondary)'\n      },\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: 'red',\n        width: size,\n        height: size,\n        textAlign: 'center'\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 12\n    }, this);\n  }\n  if (!websiteUrl) {\n    return /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0\n      },\n      animate: {\n        opacity: 1\n      },\n      style: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        width: size,\n        height: size,\n        backgroundColor: 'var(--bg-secondary)',\n        borderRadius: '8px',\n        color: 'var(--text-secondary)',\n        textAlign: 'center',\n        padding: '10px',\n        fontSize: '14px'\n      },\n      children: \"No website URL available.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0,\n      scale: 0.8\n    },\n    animate: {\n      opacity: 1,\n      scale: 1\n    },\n    transition: {\n      duration: 0.5\n    },\n    style: {\n      background: 'white',\n      padding: '16px',\n      borderRadius: '8px',\n      display: 'inline-block',\n      width: size,\n      height: size\n    },\n    children: /*#__PURE__*/_jsxDEV(QRCode, {\n      value: websiteUrl,\n      size: size - 32 // Account for padding\n      ,\n      style: {\n        width: \"100%\",\n        height: \"auto\"\n      },\n      viewBox: \"0 0 \".concat(size - 32, \" \").concat(size - 32)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 5\n  }, this);\n}\n_s(CompanyQRCode, \"8YiWRHoCgKTDnuP5cLx7kBGpsjM=\");\n_c = CompanyQRCode;\nexport default CompanyQRCode;\nvar _c;\n$RefreshReg$(_c, \"CompanyQRCode\");","map":{"version":3,"names":["React","useState","useEffect","supabase","QRCode","motion","getCachedData","cacheData","isOnline","jsxDEV","_jsxDEV","CompanyQRCode","_ref","_s","companyId","size","websiteUrl","setWebsiteUrl","loading","setLoading","error","setError","cacheKey","concat","cachedUrl","fetchCompanyUrl","console","log","data","from","select","eq","maybeSingle","url","website","err","subscription","channel","on","event","schema","table","filter","payload","newUrl","new","subscribe","removeChannel","div","initial","opacity","animate","style","display","alignItems","justifyContent","width","height","backgroundColor","borderRadius","color","children","fileName","_jsxFileName","lineNumber","columnNumber","textAlign","flexDirection","padding","fontSize","scale","transition","duration","background","value","viewBox","_c","$RefreshReg$"],"sources":["/Users/pablognecco/Dropbox (Personal)/Studio/Civic/pitch/framer-motion-bubbles/src/components/CompanyQRCode.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { supabase } from '../config/supabase';\nimport QRCode from \"react-qr-code\";\nimport { motion } from \"framer-motion\";\nimport { getCachedData, cacheData, isOnline } from '../utils/cacheManager';\n\nfunction CompanyQRCode({ companyId, size = 128 }) {\n  const [websiteUrl, setWebsiteUrl] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const cacheKey = `company_qr_${companyId}`;\n\n  useEffect(() => {\n    if (!companyId) {\n      setLoading(false);\n      setError(\"No company ID provided.\");\n      return;\n    }\n\n    // Try cache first\n    const cachedUrl = getCachedData(cacheKey);\n    if (cachedUrl) {\n      setWebsiteUrl(cachedUrl);\n      setLoading(false);\n    }\n\n    const fetchCompanyUrl = async () => {\n      if (!isOnline()) {\n        if (!cachedUrl) setError(\"Offline and no data in cache.\");\n        setLoading(false);\n        return;\n      }\n\n      setLoading(true);\n      setError(null);\n      try {\n        console.log(`[QRCode] Fetching from Supabase with id: ${companyId}`);\n\n        const { data, error } = await supabase\n          .from('companies')\n          .select('website')\n          .eq('id', companyId)\n          .maybeSingle();\n\n        console.log(\"[QRCode] Supabase fetch response:\", { data, error });\n\n        if (error) throw error;\n        \n        const url = data && data.website;\n        setWebsiteUrl(url);\n        if (url) {\n          cacheData(cacheKey, url);\n        }\n\n      } catch (err) {\n        console.error(\"Error fetching company URL:\", err);\n        setError(\"Failed to load company data.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchCompanyUrl();\n\n    const subscription = supabase\n      .channel(`company-website-${companyId}`)\n      .on(\n        'postgres_changes',\n        { \n          event: 'UPDATE', \n          schema: 'public', \n          table: 'companies',\n          filter: `id=eq.${companyId}`\n        },\n        (payload) => {\n          const newUrl = payload.new.website;\n          if (newUrl !== websiteUrl) {\n            setWebsiteUrl(newUrl);\n            cacheData(cacheKey, newUrl);\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(subscription);\n    };\n  }, [companyId, websiteUrl, cacheKey]);\n\n  if (loading) {\n    return (\n        <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            style={{ \n                display: 'flex', \n                alignItems: 'center', \n                justifyContent: 'center', \n                width: size, \n                height: size,\n                backgroundColor: 'var(--bg-secondary)',\n                borderRadius: '8px',\n                color: 'var(--text-secondary)'\n            }}\n        >\n            Loading...\n        </motion.div>\n    );\n  }\n\n  if (error) {\n    return <div style={{ color: 'red', width: size, height: size, textAlign: 'center' }}>{error}</div>;\n  }\n\n  if (!websiteUrl) {\n    return (\n        <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        style={{ \n            display: 'flex', \n            flexDirection: 'column',\n            alignItems: 'center', \n            justifyContent: 'center', \n            width: size, \n            height: size,\n            backgroundColor: 'var(--bg-secondary)',\n            borderRadius: '8px',\n            color: 'var(--text-secondary)',\n            textAlign: 'center',\n            padding: '10px',\n            fontSize: '14px'\n        }}\n    >\n        No website URL available.\n    </motion.div>\n    )\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.8 }}\n      animate={{ opacity: 1, scale: 1 }}\n      transition={{ duration: 0.5 }}\n      style={{ \n          background: 'white', \n          padding: '16px', \n          borderRadius: '8px', \n          display: 'inline-block',\n          width: size,\n          height: size\n        }}\n    >\n      <QRCode\n        value={websiteUrl}\n        size={size - 32} // Account for padding\n        style={{ width: \"100%\", height: \"auto\" }}\n        viewBox={`0 0 ${size-32} ${size-32}`}\n      />\n    </motion.div>\n  );\n}\n\nexport default CompanyQRCode;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}